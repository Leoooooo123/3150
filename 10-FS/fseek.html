<!DOCTYPE HTML>
<html lang="en" >
    
    <head>
        
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>Getting data using fseek | CSCI3150 - File System</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 2.6.7">
        
        
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">
        
    <link rel="stylesheet" href="gitbook/style.css">
    
        
        <link rel="stylesheet" href="gitbook/plugins/gitbook-plugin-highlight/website.css">
        
    
        
        <link rel="stylesheet" href="gitbook/plugins/gitbook-plugin-search/search.css">
        
    
        
        <link rel="stylesheet" href="gitbook/plugins/gitbook-plugin-fontsettings/website.css">
        
    
    

        
    
    
    <link rel="next" href="./fd.html" />
    
    
    <link rel="prev" href="./binary.html" />
    

        
    </head>
    <body>
        
        
    <div class="book"
        data-level="2.4"
        data-chapter-title="Getting data using fseek"
        data-filepath="fseek.md"
        data-basepath="."
        data-revision="Tue Nov 08 2016 18:19:27 GMT+0800 (HKT)"
        data-innerlanguage="">
    

<div class="book-summary">
    <nav role="navigation">
        <ul class="summary">
            
            
            
            

            

            
    
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="./index.html">
                
                        <i class="fa fa-check"></i>
                        
                        Goal of this lab
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1" >
            
            <span><b>1.</b> Important commands</span>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1" data-path="as.html">
            
                
                    <a href="./as.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.1.</b>
                        
                        File permission
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="mount.html">
            
                
                    <a href="./mount.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.2.</b>
                        
                        mount
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="stat.html">
            
                
                    <a href="./stat.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.3.</b>
                        
                        stat
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="df.html">
            
                
                    <a href="./df.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.4.</b>
                        
                        checking disk space utilization
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2" >
            
            <span><b>2.</b> C functions to deal with files</span>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1" data-path="intro.html">
            
                
                    <a href="./intro.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.</b>
                        
                        C File I/O
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="text.html">
            
                
                    <a href="./text.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.2.</b>
                        
                        Text I/O Functions
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="binary.html">
            
                
                    <a href="./binary.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.3.</b>
                        
                        Binary I/O Functions
                    </a>
            
            
        </li>
    
        <li class="chapter active" data-level="2.4" data-path="fseek.html">
            
                
                    <a href="./fseek.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.4.</b>
                        
                        Getting data using fseek
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3" >
            
            <span><b>3.</b> Linux file system calls</span>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1" data-path="fd.html">
            
                
                    <a href="./fd.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.</b>
                        
                        File descriptor
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="syscall.html">
            
                
                    <a href="./syscall.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.2.</b>
                        
                        Basic file functions
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="dir.html">
            
                
                    <a href="./dir.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.3.</b>
                        
                        Directory
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4" data-path="refer.html">
            
                
                    <a href="./refer.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.</b>
                        
                        Reference
                    </a>
            
            
        </li>
    


            
            <li class="divider"></li>
            <li>
                <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
                    Published with GitBook
                </a>
            </li>
            
        </ul>
    </nav>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header" role="navigation">
    <!-- Actions Left -->
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="./" >CSCI3150 - File System</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1" role="main">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-">
                    
                        <h1 id="getting-data-using-fseek">Getting data using fseek</h1>
<p>If you have many records inside a file and need to access a record at a specific position, how would you do? An easier way to get to the required data can be achieved using <code>fseek()</code>. <code>fseek()</code> let you &quot;random access&quot; a file. During file I/O, a long integer called offset is used to keep track of the next byte to read or write. Offset represents the number of bytes from the beginning of the file to that next character. Random access I/O is achieved by changing the value of offset using the <code>fseek()</code>. You can look up the manual page of fseek() to see more details.</p>
<pre><code>int fseek(FILE *stream, long offset, int whence);
</code></pre><p>The  <code>fseek()</code> function sets the file position indicator for the stream pointed to by stream. The new position, measured in bytes, is obtained by adding offset bytes to the position specified by whence. &quot;whence&quot; can be set as the following values.</p>
<table>
<tr>
  <td>Value</td>
  <td>Description </td>
</tr>
  <tr>
    <td>SEEK_SET</td>
    <td>Seek from the start of file</td>
  </tr>
  <tr>
    <td>SEEK_CUR</td>
    <td>Seek from the current location</td>
  </tr>
  <tr>
    <td>SEEK_END</td>
    <td>Seek from the end of file</td>
  </tr>
  </table>




<p><a href="code/seekfile.c"><code>seekfile.c</code></a> is an example about how to random access file. File <a href="code/student.dat">&quot;student.dat&quot;</a> is a binary file that contains many records of students. We use <code>fseek(-)</code> to access the record we want.</p>
<pre><code class="lang-c"><span class="hljs-comment">/*seekfile.c*/</span>
<span class="hljs-preprocessor">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-preprocessor">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;stdlib.h&gt;</span></span>
<span class="hljs-keyword">struct</span> Student{
    <span class="hljs-keyword">char</span> sid[<span class="hljs-number">11</span>];
    <span class="hljs-keyword">char</span> name[<span class="hljs-number">20</span>];
    <span class="hljs-keyword">int</span> marks;
};

<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> * argv[])</span></span>{
    FILE * fp;
    <span class="hljs-keyword">int</span> offset;
    <span class="hljs-keyword">struct</span> Student stu;
    <span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>;
    fp = fopen(<span class="hljs-string">&quot;student.dat&quot;</span>,<span class="hljs-string">&quot;rb&quot;</span>);         

    <span class="hljs-keyword">if</span>(fp == <span class="hljs-literal">NULL</span>){
        perror(<span class="hljs-string">&quot;fopen\n&quot;</span>);
        <span class="hljs-built_in">exit</span>(EXIT_FAILURE);
    }

    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Last record in file.\n&quot;</span>);
    offset = -(<span class="hljs-keyword">sizeof</span>(stu));
    fseek(fp,offset,SEEK_END);
    fread(&amp;stu,<span class="hljs-keyword">sizeof</span>(stu),<span class="hljs-number">1</span>,fp);
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\n\tStudent ID : %s&quot;</span>,stu.sid);
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\n\tName : %s&quot;</span>,stu.name);
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\n\tMarks : %d&quot;</span>,stu.marks);
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\nCurrent offset:%ld&quot;</span>,ftell(fp));

    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\n\nFirst record in file.\n&quot;</span>);
    fseek(fp,<span class="hljs-number">0</span>,SEEK_SET);
    fread(&amp;stu,<span class="hljs-keyword">sizeof</span>(stu),<span class="hljs-number">1</span>,fp);
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\n\tStudent ID : %s&quot;</span>,stu.sid);
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\n\tName : %s&quot;</span>,stu.name);
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\n\tMarks : %d&quot;</span>,stu.marks);
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\nCurrent offset:%ld&quot;</span>,ftell(fp));

    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\n\nSecond record in file.\n&quot;</span>);
    fseek(fp,<span class="hljs-number">0</span>,SEEK_CUR);
    fread(&amp;stu,<span class="hljs-keyword">sizeof</span>(stu),<span class="hljs-number">1</span>,fp);
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\n\tStudent ID : %s&quot;</span>,stu.sid);
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\n\tName : %s&quot;</span>,stu.name);
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\n\tMarks : %d&quot;</span>,stu.marks);
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\nCurrent offset:%ld&quot;</span>,ftell(fp));

    fclose(fp);
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p><img src="pic/fseek.png" alt="">
You can use the following program <a href="code/creat_data.c"><code>creat_data.c</code></a> to generate your own &quot;student.dat&quot; file.</p>
<pre><code class="lang-c"><span class="hljs-comment">/*creat_data.c*/</span>
<span class="hljs-preprocessor">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span>
<span class="hljs-preprocessor">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-keyword">struct</span> Student{
    <span class="hljs-keyword">char</span> sid[<span class="hljs-number">11</span>];
    <span class="hljs-keyword">char</span> name[<span class="hljs-number">20</span>];
    <span class="hljs-keyword">int</span> marks;
};
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> * argv[])</span></span>{
    <span class="hljs-keyword">int</span> i=<span class="hljs-number">9</span>;
    <span class="hljs-keyword">struct</span> Student stu;
    FILE * fp;
    fp = fopen(<span class="hljs-string">&quot;student.dat&quot;</span>,<span class="hljs-string">&quot;wb&quot;</span>);
    <span class="hljs-keyword">while</span>((i--)&gt;<span class="hljs-number">0</span>){
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Student ID(10 digits):\n&quot;</span>);
        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%s&quot;</span>,stu.sid);
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Student Name:\n&quot;</span>);
        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%s&quot;</span>,stu.name);
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Marks:\n&quot;</span>);
        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%d&quot;</span>,&amp;stu.marks);
        fwrite(&amp;stu,<span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">struct</span> Student),<span class="hljs-number">1</span>,fp);
    }
    fclose(fp);
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="./binary.html" class="navigation navigation-prev " aria-label="Previous page: Binary I/O Functions"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="./fd.html" class="navigation navigation-next " aria-label="Next page: File descriptor"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="gitbook/app.js"></script>

    
    <script src="gitbook/plugins/gitbook-plugin-search/lunr.min.js"></script>
    

    
    <script src="gitbook/plugins/gitbook-plugin-search/search.js"></script>
    

    
    <script src="gitbook/plugins/gitbook-plugin-sharing/buttons.js"></script>
    

    
    <script src="gitbook/plugins/gitbook-plugin-fontsettings/buttons.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"highlight":{},"search":{"maxIndexSize":1000000},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
