<!DOCTYPE HTML>
<html lang="en" >
    
    <head>
        
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>Exercise 1 | CSCI3150 - IPC-Pipe</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 2.6.7">
        
        
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">
        
    <link rel="stylesheet" href="gitbook/style.css">
    
        
        <link rel="stylesheet" href="gitbook/plugins/gitbook-plugin-highlight/website.css">
        
    
        
        <link rel="stylesheet" href="gitbook/plugins/gitbook-plugin-search/search.css">
        
    
        
        <link rel="stylesheet" href="gitbook/plugins/gitbook-plugin-fontsettings/website.css">
        
    
    
        <link rel="stylesheet" href="./styles/website.css">
    

        
    
    
    <link rel="next" href="./connecting-two-programs-with-pipe.html" />
    
    
    <link rel="prev" href="./pipe-with-fork.html" />
    

        
    </head>
    <body>
        
        
    <div class="book"
        data-level="2.3"
        data-chapter-title="Exercise 1"
        data-filepath="exercise-1.md"
        data-basepath="."
        data-revision="Mon Mar 06 2017 01:47:38 GMT+0800 (HKT)"
        data-innerlanguage="">
    

<div class="book-summary">
    <nav role="navigation">
        <ul class="summary">
            
            
            
            

            

            
    
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="./index.html">
                
                        <i class="fa fa-check"></i>
                        
                        Introduction
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1" data-path="knowing-about-pipe.html">
            
                
                    <a href="./knowing-about-pipe.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                        Knowing about pipe
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1" data-path="pipe-overview.html">
            
                
                    <a href="./pipe-overview.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.1.</b>
                        
                        Pipe Overview
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="system-call-pipe.html">
            
                
                    <a href="./system-call-pipe.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.2.</b>
                        
                        System Call pipe
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2" data-path="learn-to-use-pipe.html">
            
                
                    <a href="./learn-to-use-pipe.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                        Learn to use pipe
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1" data-path="pipe-creation.html">
            
                
                    <a href="./pipe-creation.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.</b>
                        
                        Pipe creation
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="pipe-with-fork.html">
            
                
                    <a href="./pipe-with-fork.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.2.</b>
                        
                        Pipe with fork
                    </a>
            
            
        </li>
    
        <li class="chapter active" data-level="2.3" data-path="exercise-1.html">
            
                
                    <a href="./exercise-1.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.3.</b>
                        
                        Exercise 1
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3" data-path="connecting-two-programs-with-pipe.html">
            
                
                    <a href="./connecting-two-programs-with-pipe.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.</b>
                        
                        Connecting two programs with pipe
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1" data-path="implement-ls-less-in-c.html">
            
                
                    <a href="./implement-ls-less-in-c.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.</b>
                        
                        Implement ls | less in C
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="exercise.html">
            
                
                    <a href="./exercise.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.2.</b>
                        
                        Exercise
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4" data-path="reference.html">
            
                
                    <a href="./reference.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.</b>
                        
                        Reference
                    </a>
            
            
        </li>
    


            
            <li class="divider"></li>
            <li>
                <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
                    Published with GitBook
                </a>
            </li>
            
        </ul>
    </nav>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header" role="navigation">
    <!-- Actions Left -->
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="./" >CSCI3150 - IPC-Pipe</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1" role="main">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-">
                    
                        <h1 id="exercise-1--use-pipe-to-synchronize-processes"><strong>Exercise 1 : Use pipe to synchronize processes</strong></h1>
<p>After trying <code>pipe1.c</code>, <code>pipe2.c</code> and <code>pipe3.c</code>, you should be able to answer questions <strong>Q1-6</strong>. According to <strong>Q4</strong>, we know that when pipe is empty, the reader process blocks until writer process write something into pipe. Similarly, when pipe is full. the writer process blocks until reader process reads something from pipe. <a href="https://eric-lo.github.io/3150/6-IPC1/code/pipe-ex1.c" target="_blank">pipe-ex1.c</a> use this property to synchronize processes. In <code>pipe-ex1.c</code>, parent and child processes need communicate with each other according to the following rules:</p>
<ul>
<li>Parent sends a message (a character &quot;p&quot;) to child.</li>
<li>Child sends acknowledgment message (a character &quot;c&quot;) to parent on receiving &quot;p&quot;, otherwise, child waits and does nothing.</li>
<li>When parent receives &quot;c&quot;, it sends the next &quot;p&quot; to child, otherwise, parent waits and does nothing.</li>
</ul>
<p>Before <code>fork()</code>, we create two pipes as shown in the following figure. Parent writes the character &quot;p&quot; across the top pipe when TELL_CHILD is called, child writes &quot;c&quot; across the bottom pipe when TELL_PARENT is called.</p>
<p><img src="assets/ex1.png" alt=""></p>
<p><strong>Exercise-1</strong> CompleteTELL_PARENT,TELL_CHILD,WAIT_PARENT,WAIT_CHILDto make parent and child communicate correctly. That is to say,pipe-ex1.cshould output as below.</p>
<h2 id=""><img src="assets/pipe_ex1.png" alt=""></h2>
<pre><code class="lang-c"><span class="hljs-comment">/*pipe-ex1.c*/</span>
<span class="hljs-preprocessor">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-preprocessor">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span>
<span class="hljs-preprocessor">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span>
<span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> pipefd1[<span class="hljs-number">2</span>],pipefd2[<span class="hljs-number">2</span>];
<span class="hljs-comment">/*Create two pipes*/</span>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">TELL_WAIT</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>{
    <span class="hljs-keyword">if</span>(pipe(pipefd1)&lt;<span class="hljs-number">0</span> || pipe(pipefd2)&lt;<span class="hljs-number">0</span>){
        perror(<span class="hljs-string">&quot;pipe&quot;</span>);
        <span class="hljs-built_in">exit</span>(EXIT_FAILURE);
    }
}

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">TELL_PARENT</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>{
  <span class="hljs-comment">/* send parent a message through pipe, need you to complete*/</span>
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Child send message to parent!\n&quot;</span>);
}

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">WAIT_PARENT</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>{
  <span class="hljs-comment">/* read message sent by parent from pipe, need you to complete*/</span>
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Child receive message from parent!\n&quot;</span>);
}

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">TELL_CHILD</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>{
  <span class="hljs-comment">/* send child a message through pipe, need you to complete*/</span>
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Parent send message to child!\n&quot;</span>);
}

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">WAIT_CHILD</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>{
  <span class="hljs-comment">/* read the message sent by child from pipe, need you to complete*/</span>
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Parent receive message from child!\n&quot;</span>);
}

<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span>* argv[])</span></span>{
    TELL_WAIT();
    <span class="hljs-keyword">pid_t</span> pid;
    pid = fork();
    <span class="hljs-comment">//set a timer, process will end after 1 second.</span>
    alarm(<span class="hljs-number">10</span>);
    <span class="hljs-keyword">if</span>(pid!=<span class="hljs-number">0</span>){
        <span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>){
            sleep(rand()%<span class="hljs-number">2</span>+<span class="hljs-number">1</span>);        
            TELL_CHILD();
            WAIT_CHILD();
        }
    }<span class="hljs-keyword">else</span>{
        <span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>){
            sleep(rand()%<span class="hljs-number">2</span>+<span class="hljs-number">1</span>);
            WAIT_PARENT();
            TELL_PARENT();
        }
      }
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="./pipe-with-fork.html" class="navigation navigation-prev " aria-label="Previous page: Pipe with fork"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="./connecting-two-programs-with-pipe.html" class="navigation navigation-next " aria-label="Next page: Connecting two programs with pipe"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="gitbook/app.js"></script>

    
    <script src="gitbook/plugins/gitbook-plugin-search/lunr.min.js"></script>
    

    
    <script src="gitbook/plugins/gitbook-plugin-search/search.js"></script>
    

    
    <script src="gitbook/plugins/gitbook-plugin-sharing/buttons.js"></script>
    

    
    <script src="gitbook/plugins/gitbook-plugin-fontsettings/buttons.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"highlight":{},"search":{"maxIndexSize":1000000},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
